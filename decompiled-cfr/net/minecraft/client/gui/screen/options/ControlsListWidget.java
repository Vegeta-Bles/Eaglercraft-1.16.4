/*
 * Decompiled with CFR 0.152.
 * 
 * Could not load the following classes:
 *  com.google.common.collect.ImmutableList
 *  org.apache.commons.lang3.ArrayUtils
 */
package net.minecraft.client.gui.screen.options;

import com.google.common.collect.ImmutableList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import net.minecraft.client.MinecraftClient;
import net.minecraft.client.gui.Element;
import net.minecraft.client.gui.screen.options.ControlsOptionsScreen;
import net.minecraft.client.gui.widget.ButtonWidget;
import net.minecraft.client.gui.widget.ElementListWidget;
import net.minecraft.client.options.KeyBinding;
import net.minecraft.client.util.math.MatrixStack;
import net.minecraft.text.LiteralText;
import net.minecraft.text.MutableText;
import net.minecraft.text.Text;
import net.minecraft.text.TranslatableText;
import net.minecraft.util.Formatting;
import org.apache.commons.lang3.ArrayUtils;

public class ControlsListWidget
extends ElementListWidget<Entry> {
    private final ControlsOptionsScreen parent;
    private int maxKeyNameLength;

    public ControlsListWidget(ControlsOptionsScreen parent, MinecraftClient client) {
        super(client, parent.width + 45, parent.height, 43, parent.height - 32, 20);
        this.parent = parent;
        Object[] objectArray = (KeyBinding[])ArrayUtils.clone((Object[])client.options.keysAll);
        Arrays.sort(objectArray);
        String _snowman2 = null;
        for (Object object : objectArray) {
            String string = ((KeyBinding)object).getCategory();
            if (!string.equals(_snowman2)) {
                _snowman2 = string;
                this.addEntry(new CategoryEntry(new TranslatableText(string)));
            }
            if ((_snowman = client.textRenderer.getWidth(_snowman = new TranslatableText(((KeyBinding)object).getTranslationKey()))) > this.maxKeyNameLength) {
                this.maxKeyNameLength = _snowman;
            }
            this.addEntry(new KeyBindingEntry((KeyBinding)object, _snowman));
        }
    }

    @Override
    protected int getScrollbarPositionX() {
        return super.getScrollbarPositionX() + 15;
    }

    @Override
    public int getRowWidth() {
        return super.getRowWidth() + 32;
    }

    public class KeyBindingEntry
    extends Entry {
        private final KeyBinding binding;
        private final Text bindingName;
        private final ButtonWidget editButton;
        private final ButtonWidget resetButton;

        private KeyBindingEntry(KeyBinding binding, Text text) {
            this.binding = binding;
            this.bindingName = text;
            this.editButton = new ButtonWidget(this, 0, 0, 75, 20, text, button -> {
                ((ControlsListWidget)ControlsListWidget.this).parent.focusedBinding = binding;
            }, ControlsListWidget.this, binding, text){
                final /* synthetic */ ControlsListWidget field_19187;
                final /* synthetic */ KeyBinding field_19188;
                final /* synthetic */ Text field_24263;
                final /* synthetic */ KeyBindingEntry field_24264;
                {
                    this.field_24264 = keyBindingEntry;
                    this.field_19187 = controlsListWidget;
                    this.field_19188 = keyBinding;
                    this.field_24263 = text2;
                    super(n, n2, n3, n4, text, pressAction);
                }

                protected MutableText getNarrationMessage() {
                    if (this.field_19188.isUnbound()) {
                        return new TranslatableText("narrator.controls.unbound", this.field_24263);
                    }
                    return new TranslatableText("narrator.controls.bound", this.field_24263, super.getNarrationMessage());
                }
            };
            this.resetButton = new ButtonWidget(this, 0, 0, 50, 20, new TranslatableText("controls.reset"), button -> {
                ((ControlsListWidget)ControlsListWidget.this).client.options.setKeyCode(binding, binding.getDefaultKey());
                KeyBinding.updateKeysByCode();
            }, ControlsListWidget.this, text){
                final /* synthetic */ ControlsListWidget field_19190;
                final /* synthetic */ Text field_24265;
                final /* synthetic */ KeyBindingEntry field_24266;
                {
                    this.field_24266 = keyBindingEntry;
                    this.field_19190 = controlsListWidget;
                    this.field_24265 = text2;
                    super(n, n2, n3, n4, text, pressAction);
                }

                protected MutableText getNarrationMessage() {
                    return new TranslatableText("narrator.controls.reset", this.field_24265);
                }
            };
        }

        @Override
        public void render(MatrixStack matrices, int index, int y, int x, int entryWidth, int entryHeight, int mouseX, int mouseY, boolean hovered, float tickDelta) {
            boolean bl = ((ControlsListWidget)ControlsListWidget.this).parent.focusedBinding == this.binding;
            ((ControlsListWidget)ControlsListWidget.this).client.textRenderer.draw(matrices, this.bindingName, (float)(x + 90 - ControlsListWidget.this.maxKeyNameLength), (float)(y + entryHeight / 2 - ((ControlsListWidget)ControlsListWidget.this).client.textRenderer.fontHeight / 2), 0xFFFFFF);
            this.resetButton.x = x + 190;
            this.resetButton.y = y;
            this.resetButton.active = !this.binding.isDefault();
            this.resetButton.render(matrices, mouseX, mouseY, tickDelta);
            this.editButton.x = x + 105;
            this.editButton.y = y;
            this.editButton.setMessage(this.binding.getBoundKeyLocalizedText());
            bl2 = false;
            if (!this.binding.isUnbound()) {
                for (KeyBinding keyBinding : ((ControlsListWidget)ControlsListWidget.this).client.options.keysAll) {
                    if (keyBinding == this.binding || !this.binding.equals(keyBinding)) continue;
                    boolean bl2 = true;
                    break;
                }
            }
            if (bl) {
                this.editButton.setMessage(new LiteralText("> ").append(this.editButton.getMessage().shallowCopy().formatted(Formatting.YELLOW)).append(" <").formatted(Formatting.YELLOW));
            } else if (bl2) {
                this.editButton.setMessage(this.editButton.getMessage().shallowCopy().formatted(Formatting.RED));
            }
            this.editButton.render(matrices, mouseX, mouseY, tickDelta);
        }

        @Override
        public List<? extends Element> children() {
            return ImmutableList.of((Object)this.editButton, (Object)this.resetButton);
        }

        @Override
        public boolean mouseClicked(double mouseX, double mouseY, int button) {
            if (this.editButton.mouseClicked(mouseX, mouseY, button)) {
                return true;
            }
            return this.resetButton.mouseClicked(mouseX, mouseY, button);
        }

        @Override
        public boolean mouseReleased(double mouseX, double mouseY, int button) {
            return this.editButton.mouseReleased(mouseX, mouseY, button) || this.resetButton.mouseReleased(mouseX, mouseY, button);
        }
    }

    public class CategoryEntry
    extends Entry {
        private final Text text;
        private final int textWidth;

        public CategoryEntry(Text text) {
            this.text = text;
            this.textWidth = ((ControlsListWidget)ControlsListWidget.this).client.textRenderer.getWidth(this.text);
        }

        @Override
        public void render(MatrixStack matrices, int index, int y, int x, int entryWidth, int entryHeight, int mouseX, int mouseY, boolean hovered, float tickDelta) {
            ((ControlsListWidget)ControlsListWidget.this).client.textRenderer.draw(matrices, this.text, (float)(((ControlsListWidget)ControlsListWidget.this).client.currentScreen.width / 2 - this.textWidth / 2), (float)(y + entryHeight - ((ControlsListWidget)ControlsListWidget.this).client.textRenderer.fontHeight - 1), 0xFFFFFF);
        }

        @Override
        public boolean changeFocus(boolean lookForwards) {
            return false;
        }

        @Override
        public List<? extends Element> children() {
            return Collections.emptyList();
        }
    }

    public static abstract class Entry
    extends ElementListWidget.Entry<Entry> {
    }
}

